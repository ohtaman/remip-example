# 🚚 配送計画最適化

大規模なEC（電子商取引）プラットフォームの物流部門の配車担当者として、複数の物流拠点（デポ）から、多数の顧客へ商品を配送する日々の計画を立てて欲しい。
すべての配送リクエストに自社便だけで応えるのは困難な日もあり、一部の配送を外部の配送業者へ委託することも選択肢に入ります。目的は、**配送総コスト（自社便の変動費＋外部委託費＋ペナルティ）を最小化する**ことです。

## 基本条件

- **計画対象日**: 1日
- **物流拠点 (Depots)**: 2拠点 (D1, D2)
- **顧客 (Customers)**: 20件
- **トラック (Vehicles)**:
  - 拠点D1: 3台 (大型1台, 小型2台)
  - 拠点D2: 2台 (大型1台, 小型1台)
- **時間枠 (Time Windows)**: 4区分
  - TW1: 09:00-12:00
  - TW2: 12:00-14:00
  - TW3: 14:00-16:00
  - TW4: 16:00-18:00

## 必須のルール

1. **出発・帰着点**: 各トラックは、所属するデポから出発し、すべての配送を終えた後、必ず出発したデポに戻らなければならない。
2. **積載量制約**: 各トラックの総積載量は、そのトラックの最大積載量を超えることはできない。
3. **顧客への訪問**: 各顧客には、いずれか1台のトラックが1度だけ訪問する（外部委託する場合を除く）。
4. **ドライバーの労働時間**: 各トラックの総稼働時間（デポ出発から帰着まで）は、最大労働時間を超えてはならない。総稼働時間には、デポと顧客、顧客間の移動時間と、各顧客での荷降ろし時間が含まれる。

## 上記以外の考慮点

1. **時間枠指定の遵守**:
   - 顧客が指定した時間枠内に到着することが理想。
   - 指定時間枠より早く到着した場合、待機時間が発生し、その時間に対して**待機ペナルティ**（コスト）が発生する。
   - 指定時間枠より遅れて到着した場合、顧客満足度の低下とみなされ、遅延時間に対して**遅延ペナルティ**（コスト）が発生する。

2. **自社便での配送**:
   - 原則として、すべての配送は自社のトラックで行う。
   - しかし、キャパシティや時間制約により不可能な場合、特定の顧客への配送を**外部業者へ委託**することができる。
   - 外部委託には、固定の委託料に加え、荷物の量に応じた**変動委託料**が発生する。これは通常、自社便で運ぶより高コストになる。

## データ

### パラメータ

| パラメータ名 | 値 | 単位 |
| :--- | :--- | :--- |
| ドライバー最大労働時間 | 8.0 | 時間 |
| 平均速度_km毎時 | 40.0 | km/h |
| 待機ペナルティ_毎時 | 1000 | 円/時間 |
| 遅延ペナルティ_毎時 | 3000 | 円/時間 |
| 外部委託_基本料金 | 5000 | 円/件 |
| 外部委託_変動料金 | 100 | 円/kg |

### 車両マスタ

| 車両ID | 拠点ID | 種別 | 最大積載量(kg) | 1kmあたりコスト (円) |
| :--- | :--- | :--- | ---:| ---:|
| V101 | D1 | Large | 1000 | 150 |
| V102 | D1 | Small | 400 | 100 |
| V103 | D1 | Small | 400 | 100 |
| V201 | D2 | Large | 1000 | 150 |
| V202 | D2 | Small | 400 | 100 |

### 拠点データ

| 拠点ID | 座標X | 座標Y |
| :--- | ---:| ---:|
| D1 | 50 | 50 |
| D2 | 5 | 80 |

### 顧客データ

| 顧客ID | 座標X | 座標Y | 荷物重量(kg) | 訪問可能_開始時刻 | 訪問可能_終了時刻 | サービス時間(分) |
| :--- | ---:| ---:| ---:| ---:| ---:| ---:|
| C01 | 83 | 55 | 110 | 9 | 12 | 15 |
| C02 | 96 | 73 | 80 | 9 | 12 | 10 |
| C03 | 80 | 12 | 150 | 14 | 16 | 20 |
| C04 | 11 | 91 | 210 | 12 | 14 | 25 |
| C05 | 52 | 84 | 130 | 16 | 18 | 15 |
| C06 | 31 | 18 | 90 | 9 | 12 | 10 |
| C07 | 1 | 29 | 180 | 14 | 16 | 20 |
| C08 | 70 | 4 | 70 | 12 | 14 | 10 |
| C09 | 49 | 29 | 120 | 16 | 18 | 15 |
| C10 | 63 | 97 | 250 | 9 | 12 | 30 |
| C11 | 24 | 53 | 140 | 14 | 16 | 20 |
| C12 | 87 | 37 | 100 | 12 | 14 | 15 |
| C13 | 42 | 4 | 60 | 9 | 12 | 10 |
| C14 | 4 | 75 | 170 | 16 | 18 | 20 |
| C15 | 28 | 65 | 190 | 12 | 14 | 25 |
| C16 | 93 | 87 | 220 | 9 | 12 | 30 |
| C17 | 61 | 18 | 110 | 14 | 16 | 15 |
| C18 | 36 | 82 | 80 | 12 | 14 | 10 |
| C19 | 17 | 42 | 160 | 9 | 12 | 20 |
| C20 | 58 | 69 | 130 | 16 | 18 | 15 |

### 5.5. 拠点-顧客間の距離マスタ

- 移動時間は 距離（km）/ 平均速度（km/時）で求められるとします。

|出発地ID|到着地ID|距離(km)|
|:--|:--|--:|
|D1|D2|54.08|
|D1|C01|33.38|
|D1|C02|49.69|
|D1|C03|48.60|
|D1|C04|56.57|
|D1|C05|34.06|
|D1|C06|37.12|
|D1|C07|53.22|
|D1|C08|50.04|
|D1|C09|21.02|
|D1|C10|48.73|
|D1|C11|26.25|
|D1|C12|39.12|
|D1|C13|46.84|
|D1|C14|48.26|
|D1|C15|26.93|
|D1|C16|57.01|
|D1|C17|33.91|
|D1|C18|34.48|
|D1|C19|34.13|
|D1|C20|20.62|
|D2|C01|82.01|
|D2|C02|91.31|
|D2|C03|94.82|
|D2|C04|6.71|
|D2|C05|47.17|
|D2|C06|66.28|
|D2|C07|51.15|
|D2|C08|85.91|
|D2|C09|62.28|
|D2|C10|60.11|
|D2|C11|30.81|
|D2|C12|92.03|
|D2|C13|82.60|
|D2|C14|1.41|
|D2|C15|27.80|
|D2|C16|88.08|
|D2|C17|78.96|
|D2|C18|31.05|
|D2|C19|40.00|
|D2|C20|54.08|
|C01|C02|21.40|
|C01|C03|43.11|
|C01|C04|74.52|
|C01|C05|44.28|
|C01|C06|63.81|
|C01|C07|85.20|
|C01|C08|52.24|
|C01|C09|42.85|
|C01|C10|46.52|
|C01|C11|59.03|
|C01|C12|18.44|
|C01|C13|65.40|
|C01|C14|80.84|
|C01|C15|55.91|
|C01|C16|33.53|
|C01|C17|42.06|
|C01|C18|54.59|
|C01|C19|67.24|
|C01|C20|29.21|
|C02|C03|63.28|
|C02|C04|86.84|
|C02|C05|51.82|
|C02|C06|78.48|
|C02|C07|100.28|
|C02|C08|73.18|
|C02|C09|61.52|
|C02|C10|38.89|
|C02|C11|74.49|
|C02|C12|37.12|
|C02|C13|81.27|
|C02|C14|92.02|
|C02|C15|68.30|
|C02|C16|14.32|
|C02|C17|64.63|
|C02|C18|60.93|
|C02|C19|83.82|
|C02|C20|38.42|
|C3|C04|90.80|
|C03|C05|30.41|
|C03|C06|49.36|
|C03|C07|80.90|
|C03|C08|12.81|
|C03|C09|35.85|
|C03|C10|86.81|
|C03|C11|69.43|
|C03|C12|25.49|
|C03|C13|38.83|
|C03|C14|91.68|
|C03|C15|74.22|
|C03|C16|76.32|
|C03|C17|19.31|
|C03|C18|80.90|
|C03|C19|74.22|
|C03|C20|61.29|
|C04|C05|41.59|
|C04|C06|32.20|
|C04|C07|62.81|
|C04|C08|98.72|
|C04|C09|73.85|
|C04|C10|52.35|
|C04|C11|39.45|
|C04|C12|96.09|
|C04|C13|91.68|
|C04|C14|17.00|
|C04|C15|32.20|
|C04|C16|82.02|
|C04|C17|89.44|
|C04|C18|26.68|
|C04|C19|49.36|
|C04|C20|51.22|
|C05|C06|69.32|
|C05|C07|69.66|
|C05|C08|81.39|
|C05|C09|55.08|
|C05|C10|16.28|
|C05|C11|37.54|
|C05|C12|60.21|
|C05|C13|80.62|
|C05|C14|48.09|
|C05|C15|29.41|
|C05|C16|41.04|
|C05|C17|66.92|
|C05|C18|16.12|
|C05|C19|57.01|
|C05|C20|16.16|
|C06|C07|31.64|
|C06|C08|41.11|
|C06|C09|22.02|
|C06|C10|84.41|
|C06|C11|35.51|
|C06|C12|59.08|
|C06|C13|17.80|
|C06|C14|60.11|
|C06|C15|47.04|
|C06|C16|89.04|
|C06|C17|30.00|
|C06|C18|64.19|
|C06|C19|29.41|
|C06|C20|57.01|
|C07|C08|78.75|
|C07|C09|50.00|
|C07|C10|85.87|
|C07|C11|30.41|
|C07|C12|92.42|
|C07|C13|49.24|
|C07|C14|46.04|
|C07|C15|38.90|
|C07|C16|108.97|
|C07|C17|61.03|
|C07|C18|61.07|
|C07|C19|20.81|
|C07|C20|69.29|
|C08|C09|32.02|
|C08|C10|93.05|
|C08|C11|68.44|
|C08|C12|34.68|
|C08|C13|28.00|
|C08|C14|93.84|
|C08|C15|81.39|
|C08|C16|86.12|
|C08|C17|17.00|
|C08|C18|86.30|
|C08|C19|69.43|
|C08|C20|66.01|
|C09|C10|69.11|
|C09|C11|35.36|
|C09|C12|45.29|
|C09|C13|25.71|
|C09|C14|58.73|
|C09|C15|41.04|
|C09|C16|73.07|
|C09|C17|15.62|
|C09|C18|54.21|
|C09|C19|36.78|
|C09|C20|41.05|
|C10|C11|59.41|
|C10|C12|61.03|
|C10|C13|95.13|
|C10|C14|60.83|
|C10|C15|49.50|
|C10|C16|32.20|
|C10|C17|80.66|
|C10|C18|29.85|
|C10|C19|77.08|
|C10|C20|28.44|
|C11|C12|64.63|
|C11|C13|51.85|
|C11|C14|24.33|
|C11|C15|12.04|
|C11|C16|76.58|
|C11|C17|49.50|
|C11|C18|30.81|
|C11|C19|13.04|
|C11|C20|37.74|
|C12|C13|55.40|
|C12|C14|84.88|
|C12|C15|67.24|
|C12|C16|50.36|
|C12|C17|32.20|
|C12|C18|61.23|
|C12|C19|70.04|
|C12|C20|41.05|
|C13|C14|74.52|
|C13|C15|62.20|
|C13|C16|98.53|
|C13|C17|23.43|
|C13|C18|78.48|
|C13|C19|43.42|
|C13|C20|66.64|
|C14|C15|24.08|
|C14|C16|89.02|
|C14|C17|75.82|
|C14|C18|32.06|
|C14|C19|35.13|
|C14|C20|54.01|
|C15|C16|69.81|
|C15|C17|59.08|
|C15|C18|18.79|
|C15|C19|25.08|
|C15|C20|30.27|
|C16|C17|78.60|
|C16|C18|57.01|
|C16|C19|88.01|
|C16|C20|38.90|
|C17|C18|69.46|
|C17|C19|50.12|
|C17|C20|51.04|
|C18|C19|43.19|
|C18|C20|22.83|
|C19|C20|48.01|

## 依頼内容

上記情報をもとに、1日分の最適な配送計画（各トラックのルートと各顧客への割付・外部委託判定）、および合計コストの試算を出力してください。

**出力要件:**

1. 各車両ごとに訪問順（デポ → 顧客1 → ... → デポ）を明記したルート表
2. どの顧客が外部委託されたか、その理由（例: 積載量/稼働時間オーバー等）
3. 各車両・外部委託ごとのコスト明細（走行距離コスト・委託料・ペナルティ等）の集計表
4. 全体の合計コスト
5. 制約違反が発生した場合は、その内容と対応（例: 一部顧客委託）の説明

できれば、主要な制約が満たされなかった場合や、制約緩和・判断ポイント・運用上の留意事項も簡単に列挙してください。
